# TUTORIAL || < Reverse Engineering Authentication >

## Overview
Mimicking the passport project folder structure from above, this tutorial document provides a quick overview of every single file contained by the project folder and describes the purpose of each one along with its interconnections to or dependencies on other files or packages.

## ROOT
* ### `server.js`
The `server.js` file is largely boilerplate JavaScript to set up the Express server and is obviously dependent on everything it explicitly requires:
* express and express-session npm packages
* `passport.js` which itself requires the passport npm package
* Express middleware to parse URL encoding and JSON and serve static files
* Sequelize models in the `/models` folder
* Routes in `html-routes.js` and `api-routes.js`

After requiring the requirements, `server.js` then syncs the database with the models using Sequelize and waits for this process to complete before starting up the server.

* ### `package.json`
Created by running `npm init`, the `package.json` lists basic project information including the entry point file, various scripts, and importantly all of the dependencies so that running `npm i` installs everything that is needed.


## CONFIG
* ### `config.json`
Automatically created by Sequelize by running `sequelize init:config`, the `config.json` specifies connection details of different development environments, three by default:

1. database_development
1. database_test
1. database_production

The `config.json` file is required by `index.js` to set up the connection to the database.

* ### `passport.js`
The `passport.js` file requires the passport npm package along with one of its strategies as authentication middleware to sign in a user. That can be called by using the `passport.authenticate()` method which we do in `api-routes.js` as a middleware function in the `/api/login` POST route. The serializing and deserializing user with passport is done at the end of the file to maintain persistent login sessions, and the configured passport is exported as a module.

### MIDDLEWARE >>
* ### `isAuthenticated.js`
This file defines middleware to check whether or not a user is logged in, and to then proceed to the next middleware function or redirect to the signup page depending on the result of the check. It is essentially nothing but a relayer or middleman performing a check when called by `html-routes.js`, and adds no input of its own.

## MODELS
* ### `index.js` 
Automatically generated by Sequelize by running `sequelize init:models`, the `index.js` file creates the Sequelize instance. Clearly the file requires Sequelize, and it requires the fs and path node modules for path writing and another Sequelize-generated file `config.json` to configure the environment. It exports the db object after associating all of the models in the database to that object.

* ### `user.js`
The `user.js` file defines the User model, a representation of the Users table in the database, using the `sequelize.define` method to specify the email and password columns along with their types, validations and constraints. The bcryptjs npm package is required to check a hashed password against an unhashed one using `bcrypt.compareSync` in the `validPassword` method on the User class, and to automatically hash a user’s password using the `bcrypt.hashSync` method before creating a new user as specified by the hook added to the User class.


## ROUTES
* ### `api-routes.js`
The `api-routes.js` file requires the Sequelize models and `passport.js`, and exports a module of POST routes for logging in and signing up users and GET routes for logging out and returning user data in JSON form. The `/api/login` POST route uses the authentication middleware defined in `passport.js`.

* ### `html-routes.js`
The `html-routes.js` file requires the path npm module for path writing, and requires the `isAuthenticated.js` file which defines middleware used in the `/members` GET route. This file exports a module of GET routes that send the appropriate HTML file to each URL the user can access in the browser. 

 
## PUBLIC
* ### `login.html`
The login HTML page is dependent on the `style.css` stylesheet and `login.js` script file as well as the external resources Bootswatch and jQuery. It links to the signup HTML page and redirects to the members HTML page upon user login.

* ### `signup.html`
The signup HTML page is dependent on the `style.css` stylesheet and `signup.js` script file as well as the external resources Bootswatch and jQuery. It links to the login HTML page and redirects to the members HTML page if  there is a current login session.

* ### `members.html`
The members HTML page is dependent on the `style.css` stylesheet and `members.js` script file as well as the external resources Bootswatch and jQuery. It simply displays the logged in user’s email address on the page.

### JS >>
* ### `login.js`
This file contains the client side JS to add interactivity to the login button on the `login.html` page and logic to handle the form action by making a POST request using jQuery.

* ### `members.js`
This file contains the jQuery GET request to the `/api/user_data` API route that enables the display of user info on the page.

* ### `signup.js`
This file contains the client side JS to add interactivity to the sign up button on the `signup.html` page and logic to handle the form action by making a POST request using jQuery.

### STYLESHEETS >>
* ### `style.css`
This file is just a very short CSS stylesheet which is common to all of the site's HTML pages but which in practice applies minimal styling to only its `login.html` and `signup.html` pages.

## Notes on Future Additions
With all of the boilerplate of authentication and sessions set up, ones could then change the passport project by fleshing out the HTML pages, adding member-specific content on the members page, and adding update and delete routes to enable password changes or user deletions. My first thought is not to simply display the text "Welcome user@email.com" upon login
